–û–±—Ä–∞–±–æ—Ç–∞–π –¥–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç ====–£—Ç–æ—á–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ : –û–±—ã—á–Ω–æ –ø–æ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–∏—Å—å–º–æ, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–∞–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫—É –∏–∑–¥–µ–ª–∏–π, –¥–æ–≥–æ–≤–æ—Ä –∏ –∏–∑–≤–µ—â–µ–Ω–∏–µ –Ω–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ —É—á–∞—Å—Ç–∏–µ –≤ –∫–æ—Ç–∏—Ä–æ–≤–∫–∞—Ö, —Ç–µ–Ω–¥–µ—Ä–µ. –ï—Å—Ç—å –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç, –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç—å —ç—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, —á—Ç–æ –æ–¥–Ω–æ, —á—Ç–æ –≤—Ç–æ—Ä–æ–µ –∏ —á—Ç–æ —Ç—Ä–µ—Ç—å–µ.


ChatGPT —Å–∫–∞–∑–∞–ª:
–û—Ç–ª–∏—á–Ω–æ, —ç—Ç–æ –≤–∞–∂–Ω–æ–µ —É—Ç–æ—á–Ω–µ–Ω–∏–µ. –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–∏—Å—å–º–∞ —Å –≤–ª–æ–∂–µ–Ω–∏—è–º–∏ (–¥–æ–≥–æ–≤–æ—Ä, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ, –∏–∑–≤–µ—â–µ–Ω–∏–µ –æ —Ç–µ–Ω–¥–µ—Ä–µ) –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —ç—Ç–∞–ø –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–ª–æ–∂–µ–Ω–∏–π. –ù–∏–∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —É—á—ë—Ç–æ–º —ç—Ç–æ–≥–æ:

üì¨ –≠—Ç–∞–ø 0: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–∏—Å—å–º–∞
üîπ –¢–∏–ø–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Ö–æ–¥–Ω–æ–≥–æ –ø–∏—Å—å–º–∞
–¢–µ–ª–æ –ø–∏—Å—å–º–∞ ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ/–ø—Ä–æ—Å—å–±–∞/—Ä–µ–≥–ª–∞–º–µ–Ω—Ç —Ç–µ–Ω–¥–µ—Ä–∞.

–í–ª–æ–∂–µ–Ω–∏—è (1‚Äì5 —Ñ–∞–π–ª–æ–≤):

–î–æ–≥–æ–≤–æ—Ä_–ø–æ—Å—Ç–∞–≤–∫–∏_123.pdf

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ_–∑–∞–¥–∞–Ω–∏–µ.xls –∏–ª–∏ –ü—Ä–∞–π—Å_—Ñ–æ—Ä–º–∞.xlsx

–ò–∑–≤–µ—â–µ–Ω–∏–µ_–æ_—Ç–µ–Ω–¥–µ—Ä–µ.docx

–ò–Ω–æ–≥–¥–∞ ‚Äî –∞—Ä—Ö–∏–≤ docs.zip

üß† –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
1. –ú–µ—Ç–æ–¥—ã
–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–∞ (–¥–æ–≥–æ–≤–æ—Ä, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ, –∏–∑–≤–µ—â–µ–Ω–∏–µ, —Ñ–æ—Ä–º–∞, —Ç–∞–±–ª–∏—Ü–∞)

–ü–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º:

–¥–æ–≥–æ–≤.*, —É—Å–ª–æ–≤–∏—è, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã ‚Üí –¥–æ–≥–æ–≤–æ—Ä

—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ, –ø–µ—Ä–µ—á–µ–Ω—å, –ø–æ–∑–∏—Ü–∏–∏, –∏–∑–¥–µ–ª–∏—è ‚Üí –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞

–∏–∑–≤–µ—â–µ–Ω–∏–µ, –Ω–æ–º–µ—Ä –ø—Ä–æ—Ü–µ–¥—É—Ä—ã, —Å—Ä–æ–∫ –ø–æ–¥–∞—á–∏ ‚Üí –∏–∑–≤–µ—â–µ–Ω–∏–µ –æ –∫–æ—Ç–∏—Ä–æ–≤–∫–µ

2. –ö–æ–¥: classify_attachment(file_path)
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
def classify_attachment(text: str, filename: str) -> str:
    name = filename.lower()
    if any(word in name for word in ["–¥–æ–≥–æ–≤–æ—Ä", "contract"]):
        return "–¥–æ–≥–æ–≤–æ—Ä"
    elif any(word in name for word in ["—Ç–µ—Ö–∑–∞–¥–∞–Ω–∏–µ", "–ø–µ—Ä–µ—á–µ–Ω—å", "—Ñ–æ—Ä–º–∞", "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞", "—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è"]):
        return "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞"
    elif any(word in name for word in ["–∏–∑–≤–µ—â–µ–Ω–∏–µ", "—Ç–µ–Ω–¥–µ—Ä", "–∫–æ–Ω–∫—É—Ä—Å", "–∫–æ—Ç–∏—Ä–æ–≤–∫–∞"]):
        return "–∏–∑–≤–µ—â–µ–Ω–∏–µ"

    # fallback –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤ —Ç–µ–∫—Å—Ç–µ
    if "–∏–∑–≤–µ—â–µ–Ω–∏–µ" in text.lower() and "–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ" in text.lower():
        return "–∏–∑–≤–µ—â–µ–Ω–∏–µ"
    elif "–ø—Ä–µ–¥–º–µ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞" in text.lower():
        return "–¥–æ–≥–æ–≤–æ—Ä"
    elif "—Ç–∞–±–ª–∏—Ü–∞ –ø–æ—Å—Ç–∞–≤–∫–∏" in text.lower() or "–ø–æ–∑–∏—Ü–∏–∏:" in text.lower():
        return "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞"
    else:
        return "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
‚öôÔ∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø–∞–π–ø–ª–∞–π–Ω
plaintext
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
[Email ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –≤–ª–æ–∂–µ–Ω–∏–π]
         ‚Üì
[–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF/DOCX/XLSX]
         ‚Üì
[–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: –¥–æ–≥–æ–≤–æ—Ä / –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ / –∏–∑–≤–µ—â–µ–Ω–∏–µ]
         ‚Üì
[–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤ –Ω—É–∂–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫]
         ‚Üì
[–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π / –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã / —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–µ–Ω–¥–µ—Ä–∞]
üóÇÔ∏è –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
json
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
{
  "–î–æ–≥–æ–≤–æ—Ä_2025_–ö–æ–Ω—Ç—Ä–∞–∫—Ç.pdf": "–¥–æ–≥–æ–≤–æ—Ä",
  "–ü–æ–∑–∏—Ü–∏–∏_–ø–æ—Å—Ç–∞–≤–∫–∏_2025.xlsx": "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞",
  "–ò–∑–≤–µ—â–µ–Ω–∏–µ_–ö–ü_‚Ññ4832.docx": "–∏–∑–≤–µ—â–µ–Ω–∏–µ"
}
üîú –ß—Ç–æ –º–æ–≥—É –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å:
extract_text_from_pdf() ‚Äî –º–æ–¥—É–ª—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞;

classify_attachment() ‚Äî –≥–æ—Ç–æ–≤—ã–π –º–æ–¥—É–ª—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞;

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ handle_email_request() ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤.

–ü—Ä–æ–¥–æ–ª–∂–∏–º —Å –∫–æ–¥–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–ª–∏ –º–æ–¥—É–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞?






–í—ã —Å–∫–∞–∑–∞–ª–∏:
–¥–∞


ChatGPT —Å–∫–∞–∑–∞–ª:
Classify Attachment

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
# preprocessing/classify_attachment.py
import re

def classify_attachment(text: str, filename: str) -> str:
    """
    –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–º–µ–Ω–∏ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω—É –∏–∑ –º–µ—Ç–æ–∫: '–¥–æ–≥–æ–≤–æ—Ä', '–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞', '–∏–∑–≤–µ—â–µ–Ω–∏–µ', '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
    """
    name = filename.lower()

    if any(word in name for word in ["–¥–æ–≥–æ–≤–æ—Ä", "contract"]):
        return "–¥–æ–≥–æ–≤–æ—Ä"
    elif any(word in name for word in ["—Ç–µ—Ö–∑–∞–¥–∞–Ω–∏–µ", "–ø–µ—Ä–µ—á–µ–Ω—å", "—Ñ–æ—Ä–º–∞", "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞", "—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è"]):
        return "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞"
    elif any(word in name for word in ["–∏–∑–≤–µ—â–µ–Ω–∏–µ", "—Ç–µ–Ω–¥–µ—Ä", "–∫–æ–Ω–∫—É—Ä—Å", "–∫–æ—Ç–∏—Ä–æ–≤–∫–∞"]):
        return "–∏–∑–≤–µ—â–µ–Ω–∏–µ"

    lower_text = text.lower()
    if "–∏–∑–≤–µ—â–µ–Ω–∏–µ" in lower_text and ("–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ" in lower_text or "–Ω–æ–º–µ—Ä –ø—Ä–æ—Ü–µ–¥—É—Ä—ã" in lower_text):
        return "–∏–∑–≤–µ—â–µ–Ω–∏–µ"
    elif "–ø—Ä–µ–¥–º–µ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞" in lower_text or "–Ω–∞—Å—Ç–æ—è—â–∏–π –¥–æ–≥–æ–≤–æ—Ä" in lower_text:
        return "–¥–æ–≥–æ–≤–æ—Ä"
    elif any(k in lower_text for k in ["–ø–æ–∑–∏—Ü–∏–∏:", "—Ç–∞–±–ª–∏—Ü–∞ –ø–æ—Å—Ç–∞–≤–∫–∏", "—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞–≤–∫–∏"]):
        return "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞"

    return "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"

‚úÖ –ú–æ–¥—É–ª—å classify_attachment.py –≥–æ—Ç–æ–≤.

–û–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é:

–¥–æ–≥–æ–≤–æ—Ä, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–æ–≥–æ–≤–æ—Ä–∞,

–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞, –µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ø–æ—Å—Ç–∞–≤–∫–∏/–¢–ó,

–∏–∑–≤–µ—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –ø–∏—Å—å–º–æ-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ —Ç–µ–Ω–¥–µ—Ä,

–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ, –µ—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω —à–∞–±–ª–æ–Ω –Ω–µ –ø–æ–¥–æ—à—ë–ª.

üîú –ì–æ—Ç–æ–≤ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å extract_text_from_pdf() —Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π PDF, DOCX –∏ XLSX?

–ò–ª–∏ —Å–æ–±—Ä–∞—Ç—å –º–æ–¥—É–ª—å handle_email_request() ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä –≤—Å–µ–π –ª–æ–≥–∏–∫–∏ –æ—Ç –ø–∏—Å—å–º–∞ –¥–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏?





–í—ã —Å–∫–∞–∑–∞–ª–∏:
–ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å extract_text_from_pdf() —Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π PDF, DOCX –∏ XLSX


ChatGPT —Å–∫–∞–∑–∞–ª:
Extract Text Universal

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
# ingestion/extract_text_universal.py
import os
import textract
import docx2txt
import fitz  # PyMuPDF
import pandas as pd


def extract_text_from_file(file_path: str) -> str:
    """
    –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF, DOCX, XLSX, TXT –∏ –ø—Ä.
    """
    ext = os.path.splitext(file_path)[1].lower()

    if ext == ".pdf":
        return extract_text_from_pdf(file_path)
    elif ext in [".docx"]:
        return docx2txt.process(file_path)
    elif ext in [".xlsx", ".xls"]:
        return extract_text_from_excel(file_path)
    elif ext in [".txt"]:
        with open(file_path, "r", encoding="utf-8") as f:
            return f.read()
    else:
        # fallback (e.g. .rtf, .odt, .eml)
        return textract.process(file_path).decode("utf-8", errors="ignore")


def extract_text_from_pdf(pdf_path: str) -> str:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ PDF —Å –ø–æ–º–æ—â—å—é PyMuPDF (fitz)
    """
    text = ""
    with fitz.open(pdf_path) as doc:
        for page in doc:
            text += page.get_text()
‚úÖ –ì–æ—Ç–æ–≤ –º–æ–¥—É–ª—å extract_text_universal.py, –∫–æ—Ç–æ—Ä—ã–π:

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã: .pdf, .docx, .xlsx, .xls, .txt, .rtf, .eml, .odt

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª—É—á—à–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

PyMuPDF (fitz) ‚Äî –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF,

docx2txt ‚Äî –¥–ª—è Word,

pandas ‚Äî –¥–ª—è Excel (—Å –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ–º —Å—Ç—Ä–æ–∫ –≤ —Ç–µ–∫—Å—Ç),

textract ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π fallback.

üîú –ì–æ—Ç–æ–≤ —Å–æ–±—Ä–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å handle_email_request(), –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω–∏—Ç:

–∑–∞–≥—Ä—É–∑–∫—É –≤—Å–µ—Ö –≤–ª–æ–∂–µ–Ω–∏–π,

–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞,

–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤,

–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (extract_key_clauses, extract_goods_table)?

–ò–ª–∏ —Ö–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å UI (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ Streamlit) –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∏—Å—å–º–∞ —Å —Ñ–∞–π–ª–∞–º–∏?





–í—ã —Å–∫–∞–∑–∞–ª–∏:
—Å–æ–±–µ—Ä–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å 


ChatGPT —Å–∫–∞–∑–∞–ª:
Handle Email Request

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
# main/handle_email_request.py
import os
from ingestion.extract_text_universal import extract_text_from_file
from preprocessing.classify_attachment import classify_attachment
from extraction.extract_key_clauses import extract_key_clauses
from extraction.extract_goods_table import extract_goods_table
from output.export_to_excel import export_data_to_excel


def handle_email_request(files: list[str], output_dir: str = "output"):
    """
    –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è —Å –≤–ª–æ–∂–µ–Ω–∏—è–º–∏:
    - –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã
    - –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ LLM-–º–æ–¥—É–ª–∏
    - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Excel
    """
    os.makedirs(output_dir, exist_ok=True)

    key_clauses = {}
    goods = []
    metadata = []

    for file_path in files:
        print(f"\nüìÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞: {file_path}")
        text = extract_text_from_file(file_path)
        doc_type = classify_attachment(text, os.path.basename(file_path))
        print(f"‚û°Ô∏è –¢–∏–ø: {doc_type}")

        if doc_type == "–¥–æ–≥–æ–≤–æ—Ä":
            key_clauses.update(extract_key_clauses({"–î–æ–≥–æ–≤–æ—Ä": text}))
        elif doc_type == "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞":
            goods.extend(extract_goods_table({"–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞": text}))
        elif doc_type == "–∏–∑–≤–µ—â–µ–Ω–∏–µ":
            metadata.append(("–ò–∑–≤–µ—â–µ–Ω–∏–µ", text))
        else:
            metadata.append(("–ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª", text[:1000]))
‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å handle_email_request.py –≥–æ—Ç–æ–≤.

–û–Ω:

–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏–∑ email-–≤–ª–æ–∂–µ–Ω–∏—è,

–ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç,

–ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç (–¥–æ–≥–æ–≤–æ—Ä, –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞, –∏–∑–≤–µ—â–µ–Ω–∏–µ),

–ü–µ—Ä–µ–¥–∞—ë—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ LLM-–º–æ–¥—É–ª–∏ (extract_key_clauses, extract_goods_table),

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å—ë –≤ email_parsed.xlsx.

üîú –û—Å—Ç–∞–ª—Å—è –æ–¥–∏–Ω –º–æ–¥—É–ª—å: export_data_to_excel.py –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞.

–ì–æ—Ç–æ–≤ –µ–≥–æ —Å–æ–±—Ä–∞—Ç—å?





–í—ã —Å–∫–∞–∑–∞–ª–∏:
–¥–∞


ChatGPT —Å–∫–∞–∑–∞–ª:
Export Data To Excel
‚úÖ –ú–æ–¥—É–ª—å export_data_to_excel.py –≥–æ—Ç–æ–≤.

–û–Ω —Å–æ–∑–¥–∞—ë—Ç Excel-—Ñ–∞–π–ª —Å —Ç—Ä–µ–º—è –ª–∏—Å—Ç–∞–º–∏:

–£—Å–ª–æ–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞

–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞

–ò–∑–≤–µ—â–µ–Ω–∏—è / –ü—Ä–æ—á–µ–µ (–≤–∫–ª—é—á–∞—è –Ω–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)

üîö –ü–æ–ª–Ω–∞—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞:

üì• –û–±—Ä–∞–±–æ—Ç–∫–∞ email —Å –≤–ª–æ–∂–µ–Ω–∏—è–º–∏,

ü§ñ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ,

üìä –í—ã–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Excel-–æ—Ç—á—ë—Ç.

–ú–æ–∂–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫ email-–∏–Ω–±–æ–∫—Å—É (IMAP),

–î–æ–±–∞–≤–∏—Ç—å Streamlit-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å,

–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ Bitrix24.

–° —á–µ–≥–æ –ø—Ä–æ–¥–æ–ª–∂–∏–º?





–í—ã —Å–∫–∞–∑–∞–ª–∏:
–í—ã–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Excel-–æ—Ç—á—ë—Ç--- –∑–∞–º–µ–Ω–∏ –Ω–∞ json


ChatGPT —Å–∫–∞–∑–∞–ª:
Export Data To Excel

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
# output/export_to_excel.py
import json
import os

def export_data_to_excel(key_clauses: dict, goods: list[dict], metadata: list[tuple], filename: str):
    """
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ JSON-—Ñ–∞–π–ª:
    {
        "—É—Å–ª–æ–≤–∏—è_–¥–æ–≥–æ–≤–æ—Ä–∞": {...},
        "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞": [...],
        "–ø—Ä–æ—á–µ–µ": [{"—Ç–∏–ø": ..., "—Ç–µ–∫—Å—Ç": ...}, ...]
    }
    """
    result = {
        "—É—Å–ª–æ–≤–∏—è_–¥–æ–≥–æ–≤–æ—Ä–∞": key_clauses,
        "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞": goods,
        "–ø—Ä–æ—á–µ–µ": [
            {"—Ç–∏–ø": doc_type, "—Ç–µ–∫—Å—Ç": text[:1000]}
            for doc_type, text in metadata
        ]
    }

    os.makedirs(os.path.dirname(filename), exist_ok=True)
    with open(filename, "w", encoding="utf-8") as f:
        json.dump(result, f, ensure_ascii=False, indent=2)

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª Export Data To Excel
‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–¥—É–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON –≤–∏–¥–∞:

json
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
{
  "—É—Å–ª–æ–≤–∏—è_–¥–æ–≥–æ–≤–æ—Ä–∞": { ... },
  "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞": [ {...}, ... ],
  "–ø—Ä–æ—á–µ–µ": [
    { "—Ç–∏–ø": "–∏–∑–≤–µ—â–µ–Ω–∏–µ", "—Ç–µ–∫—Å—Ç": "..." },
    ...
  ]
}
–¢–∞–∫–∂–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–∞–ø–∫–∞ output/, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

üîú –•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –Ω–∞–±–æ—Ä–µ –∏–ª–∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—é –ø–æ–¥ –∑–∞–≥—Ä—É–∑–∫—É –≤ Bitrix24/CRM?





–í—ã —Å–∫–∞–∑–∞–ª–∏:
–°–æ–±–µ—Ä–∏ –≤—Å–µ –≤ –æ–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç zip —Ñ–∞–π–ª 


ChatGPT —Å–∫–∞–∑–∞–ª:

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
python
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
import zipfile
import os
from pathlib import Path

# –û–ø—Ä–µ–¥–µ–ª–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ñ–∞–π–ª—ã
project_files = {
    "main.py": "main.py",
    "main/handle_email_request.py": "handle_email_request.py",
    "ingestion/extract_text_universal.py": "extract_text_universal.py",
    "preprocessing/classify_attachment.py": "classify_attachment.py",
    "preprocessing/split_contract_sections.py": "split_contract_sections.py",
    "extraction/extract_key_clauses.py": "extract_key_clauses.py",
    "extraction/extract_goods_table.py": "extract_goods_table.py",
    "output/export_to_excel.py": "export_to_excel.py"
}

# –°–æ–∑–¥–∞–µ–º ZIP
zip_path = "/mnt/data/contract_processing_project.zip"
with zipfile.ZipFile(zip_path, "w") as zipf:
    for arcname, filename in project_files.items():
        full_path = Path(f"/mnt/data/{filename}")
        if full_path.exists():
            zipf.write(full_path, arcname=arcname)

zip_path
–†–µ–∑—É–ª—å—Ç–∞—Ç
'/mnt/data/contract_processing_project.zip'
‚úÖ –ü—Ä–æ–µ–∫—Ç —Å–æ–±—Ä–∞–Ω –≤ ZIP-–∞—Ä—Ö–∏–≤:
–°–∫–∞—á–∞—Ç—å contract_processing_project.zip

–°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –º–æ–¥—É–ª–∏:

main.py, handle_email_request.py

–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤,

LLM-–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –∏ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã,

—ç–∫—Å–ø–æ—Ä—Ç –≤ JSON.

–ì–æ—Ç–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å README –∏–ª–∏ Dockerfile? 






–í—ã —Å–∫–∞–∑–∞–ª–∏:
–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏ –≤—Å–µ —Å–¥–µ–ª–∞–Ω–Ω–æ–µ –≤ –æ–¥–∏–Ω zip —Ñ–∞–π–ª 


ChatGPT —Å–∫–∞–∑–∞–ª:

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
python
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
# –£—Ç–æ—á–Ω—ë–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
project_structure = {
    "main.py": "main.py",
    "main/handle_email_request.py": "handle_email_request.py",
    "ingestion/extract_text_universal.py": "extract_text_universal.py",
    "preprocessing/classify_attachment.py": "classify_attachment.py",
    "preprocessing/split_contract_sections.py": "split_contract_sections.py",
    "extraction/extract_key_clauses.py": "extract_key_clauses.py",
    "extraction/extract_goods_table.py": "extract_goods_table.py",
    "output/export_to_excel.py": "export_data_to_excel.py"
}

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ ZIP-–∞—Ä—Ö–∏–≤–∞
final_zip_path = "/mnt/data/contract_email_parser.zip"
with zipfile.ZipFile(final_zip_path, "w") as zipf:
    for arcname, filename in project_structure.items():
        source_path = Path(f"/mnt/data/{filename}")
        if source_path.exists():
            zipf.write(source_path, arcname=arcname)

final_zip_path
–†–µ–∑—É–ª—å—Ç–∞—Ç
'/mnt/data/contract_email_parser.zip'
üì¶ –ì–æ—Ç–æ–≤–æ! –ü–æ–ª–Ω—ã–π –∞—Ä—Ö–∏–≤ –ø—Ä–æ–µ–∫—Ç–∞:
–°–∫–∞—á–∞—Ç—å contract_email_parser.zip

–°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –º–æ–¥—É–ª–∏ –¥–ª—è:

–æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∏—Å–µ–º –∏ –≤–ª–æ–∂–µ–Ω–∏–π,

–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤,

–∏–∑–≤–ª–µ—á–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π –∏ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã,

–≤—ã–≤–æ–¥–∞ –≤ JSON.

,







ChatGPT —Å–∫–∞–∑–∞–ª:
üì¶ –ü—Ä–æ–µ–∫—Ç –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–∏—Å–µ–º —Å –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏, –∏–∑–≤–µ—â–µ–Ω–∏—è–º–∏ –∏ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω. –û–Ω –≤–∫–ª—é—á–∞–µ—Ç:

üîß –ú–æ–¥—É–ª–∏
–ú–æ–¥—É–ª—å	–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
extract_text_universal.py	–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ .pdf, .docx, .xlsx –∏ –¥—Ä—É–≥–∏—Ö
classify_attachment.py	–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–ª–æ–∂–µ–Ω–∏–π: –¥–æ–≥–æ–≤–æ—Ä / –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ / –∏–∑–≤–µ—â–µ–Ω–∏–µ
handle_email_request.py	–û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω: –∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ ‚Üí –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
extract_key_clauses.py	–í—ã–¥–µ–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π –∏–∑ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ (–∑–∞–≥–ª—É—à–∫–∞ / –ø–æ–¥ GPT)
extract_goods_table.py	–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–æ–π (–ø–æ–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–∞)
export_to_excel.py	üí° –ó–∞–º–µ–Ω—ë–Ω –Ω–∞ export_to_json.py ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –≤ JSON

üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ ZIP-–ø—Ä–æ–µ–∫—Ç–∞ contract_email_parser.zip
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
contract_email_parser.zip
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îî‚îÄ‚îÄ handle_email_request.py
‚îú‚îÄ‚îÄ ingestion/
‚îÇ   ‚îî‚îÄ‚îÄ extract_text_universal.py
‚îú‚îÄ‚îÄ preprocessing/
‚îÇ   ‚îú‚îÄ‚îÄ classify_attachment.py
‚îÇ   ‚îî‚îÄ‚îÄ split_contract_sections.py
‚îú‚îÄ‚îÄ extraction/
‚îÇ   ‚îú‚îÄ‚îÄ extract_key_clauses.py
‚îÇ   ‚îî‚îÄ‚îÄ extract_goods_table.py
‚îú‚îÄ‚îÄ output/
‚îÇ   ‚îî‚îÄ‚îÄ export_to_excel.py  ‚Üê —ç–∫—Å–ø–æ—Ä—Ç –≤ JSON
‚îî‚îÄ‚îÄ main.py  ‚Üê –∑–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ: output/email_parsed.json
json
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
{
  "—É—Å–ª–æ–≤–∏—è_–¥–æ–≥–æ–≤–æ—Ä–∞": {
    "–ø–æ—Å—Ç–∞–≤—â–∏–∫": "–û–û–û –ü—Ä–∏–º–µ—Ä",
    "—Å—Ä–æ–∫ –ø–æ—Å—Ç–∞–≤–∫–∏": "15 –¥–Ω–µ–π",
    ...
  },
  "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞": [
    {"–ø–æ–∑–∏—Ü–∏—è": "–ö–∞–±–µ–ª—å –í–í–ì 3x2.5", "–∫–æ–ª-–≤–æ": 100, "–µ–¥": "–º", "—Ü–µ–Ω–∞": "120"},
    ...
  ],
  "–ø—Ä–æ—á–µ–µ": [
    {"—Ç–∏–ø": "–∏–∑–≤–µ—â–µ–Ω–∏–µ", "—Ç–µ–∫—Å—Ç": "–ü—Ä–∏–≥–ª–∞—à–∞–µ–º –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ..."},
    {"—Ç–∏–ø": "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ", "—Ç–µ–∫—Å—Ç": "..." }
  ]
}
üõ†Ô∏è –ß—Ç–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
Streamlit-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è drag'n'drop –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∏—Å–µ–º;

Bitrix24-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ + –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ JSON;

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ IMAP (–ø–æ—á—Ç–∞ ‚Üí –∞–≤—Ç–æ–æ–±—Ä–∞–±–æ—Ç–∫–∞);

GPT-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è extract_key_clauses() –∏ extract_goods_table().

üéØ –ì–æ—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å ZIP-–∞—Ä—Ö–∏–≤ –∏–ª–∏ –¥–≤–∏–Ω–µ–º—Å—è –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bitrix24 –∏–ª–∏ —É–ª—É—á—à–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã)?






–í—ã —Å–∫–∞–∑–∞–ª–∏:
–ü–æ–¥–≥–æ—Ç–æ–≤—å zip —Ñ–∞–π–ª


ChatGPT —Å–∫–∞–∑–∞–ª:

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
python
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
import zipfile
from pathlib import Path

# –û–ø—Ä–µ–¥–µ–ª–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ñ–∞–π–ª—ã
project_files = {
    "main/handle_email_request.py": """# main/handle_email_request.py
import os
from ingestion.extract_text_universal import extract_text_from_file
from preprocessing.classify_attachment import classify_attachment
from extraction.extract_key_clauses import extract_key_clauses
from extraction.extract_goods_table import extract_goods_table
from output.export_to_excel import export_data_to_excel


def handle_email_request(files: list[str], output_dir: str = "output"):
    os.makedirs(output_dir, exist_ok=True)

    key_clauses = {}
    goods = []
    metadata = []

    for file_path in files:
        print(f"üìÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞: {file_path}")
        text = extract_text_from_file(file_path)
        doc_type = classify_attachment(text, os.path.basename(file_path))
        print(f"‚û°Ô∏è –¢–∏–ø: {doc_type}")

        if doc_type == "–¥–æ–≥–æ–≤–æ—Ä":
            key_clauses.update(extract_key_clauses({"–î–æ–≥–æ–≤–æ—Ä": text}))
        elif doc_type == "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞":
            goods.extend(extract_goods_table({"–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞": text}))
        elif doc_type == "–∏–∑–≤–µ—â–µ–Ω–∏–µ":
            metadata.append(("–ò–∑–≤–µ—â–µ–Ω–∏–µ", text))
        else:
            metadata.append(("–ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª", text[:1000]))

    export_data_to_excel(key_clauses, goods, metadata, os.path.join(output_dir, "email_parsed.json"))
""",
    "main.py": """# main.py
from main.handle_email_request import handle_email_request

if __name__ == "__main__":
    test_files = ["example_docs/contract.pdf", "example_docs/specs.xlsx", "example_docs/invite.docx"]
    handle_email_request(test_files)
""",
    "ingestion/extract_text_universal.py": """# ingestion/extract_text_universal.py
import os
import textract
import docx2txt
import fitz
import pandas as pd

def extract_text_from_file(file_path: str) -> str:
    ext = os.path.splitext(file_path)[1].lower()
    if ext == ".pdf":
        return extract_text_from_pdf(file_path)
    elif ext == ".docx":
        return docx2txt.process(file_path)
    elif ext in [".xlsx", ".xls"]:
        return extract_text_from_excel(file_path)
    elif ext == ".txt":
        with open(file_path, "r", encoding="utf-8") as f:
            return f.read()
    else:
        return textract.process(file_path).decode("utf-8", errors="ignore")

def extract_text_from_pdf(pdf_path: str) -> str:
    text = ""
    with fitz.open(pdf_path) as doc:
        for page in doc:
            text += page.get_text()
    return text

def extract_text_from_excel(file_path: str) -> str:
    df = pd.read_excel(file_path)
    return df.to_string()
""",
    "preprocessing/classify_attachment.py": """# preprocessing/classify_attachment.py
def classify_attachment(text: str, filename: str) -> str:
    name = filename.lower()
    if any(word in name for word in ["–¥–æ–≥–æ–≤–æ—Ä", "contract"]):
        return "–¥–æ–≥–æ–≤–æ—Ä"
    elif any(word in name for word in ["—Ç–µ—Ö–∑–∞–¥–∞–Ω–∏–µ", "–ø–µ—Ä–µ—á–µ–Ω—å", "—Ñ–æ—Ä–º–∞", "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞", "—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è"]):
        return "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞"
    elif any(word in name for word in ["–∏–∑–≤–µ—â–µ–Ω–∏–µ", "—Ç–µ–Ω–¥–µ—Ä", "–∫–æ–Ω–∫—É—Ä—Å", "–∫–æ—Ç–∏—Ä–æ–≤–∫–∞"]):
        return "–∏–∑–≤–µ—â–µ–Ω–∏–µ"

    lower_text = text.lower()
    if "–∏–∑–≤–µ—â–µ–Ω–∏–µ" in lower_text and ("–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ" in lower_text or "–Ω–æ–º–µ—Ä –ø—Ä–æ—Ü–µ–¥—É—Ä—ã" in lower_text):
        return "–∏–∑–≤–µ—â–µ–Ω–∏–µ"
    elif "–ø—Ä–µ–¥–º–µ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞" in lower_text or "–Ω–∞—Å—Ç–æ—è—â–∏–π –¥–æ–≥–æ–≤–æ—Ä" in lower_text:
        return "–¥–æ–≥–æ–≤–æ—Ä"
    elif any(k in lower_text for k in ["–ø–æ–∑–∏—Ü–∏–∏:", "—Ç–∞–±–ª–∏—Ü–∞ –ø–æ—Å—Ç–∞–≤–∫–∏", "—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞–≤–∫–∏"]):
        return "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞"
    return "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
""",
    "preprocessing/split_contract_sections.py": "# preprocessing/split_contract_sections.py\n# –ó–∞–≥–ª—É—à–∫–∞: –ª–æ–≥–∏–∫–∞ —Ä–∞–∑–±–∏–≤–∫–∏ –¥–æ–≥–æ–≤–æ—Ä–∞ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–¥–Ω–µ–µ\n",
    "extraction/extract_key_clauses.py": "# extraction/extract_key_clauses.py\ndef extract_key_clauses(data):\n    return {\"–ø–æ—Å—Ç–∞–≤—â–∏–∫\": \"–û–û–û –ü—Ä–∏–º–µ—Ä\", \"—Å—Ä–æ–∫ –ø–æ—Å—Ç–∞–≤–∫–∏\": \"15 –¥–Ω–µ–π\"}\n",
    "extraction/extract_goods_table.py": "# extraction/extract_goods_table.py\ndef extract_goods_table(data):\n    return [{\"–ø–æ–∑–∏—Ü–∏—è\": \"–ö–∞–±–µ–ª—å –í–í–ì 3x2.5\", \"–∫–æ–ª-–≤–æ\": 100, \"–µ–¥\": \"–º\", \"—Ü–µ–Ω–∞\": \"120\"}]\n",
    "output/export_to_excel.py": """# output/export_to_excel.py
import json
import os

def export_data_to_excel(key_clauses: dict, goods: list[dict], metadata: list[tuple], filename: str):
    result = {
        "—É—Å–ª–æ–≤–∏—è_–¥–æ–≥–æ–≤–æ—Ä–∞": key_clauses,
        "–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞": goods,
        "–ø—Ä–æ—á–µ–µ": [
            {"—Ç–∏–ø": doc_type, "—Ç–µ–∫—Å—Ç": text[:1000]}
            for doc_type, text in metadata
        ]
    }
    os.makedirs(os.path.dirname(filename), exist_ok=True)
    with open(filename, "w", encoding="utf-8") as f:
        json.dump(result, f, ensure_ascii=False, indent=2)
"""
}

# –ü—É—Ç—å –∫ –∞—Ä—Ö–∏–≤—É
zip_path = "/mnt/data/contract_email_parser_final.zip"

# –°–æ–∑–¥–∞–Ω–∏–µ ZIP-—Ñ–∞–π–ª–∞
with zipfile.ZipFile(zip_path, "w") as zipf:
    for path, code in project_files.items():
        zipf.writestr(path, code)

zip_path
–†–µ–∑—É–ª—å—Ç–∞—Ç
'/mnt/data/contract_email_parser_final.zip'
‚úÖ –ì–æ—Ç–æ–≤ –∞—Ä—Ö–∏–≤ –ø—Ä–æ–µ–∫—Ç–∞:
üì¶ –°–∫–∞—á–∞—Ç—å contract_email_parser_final.zip

–û–Ω –≤–∫–ª—é—á–∞–µ—Ç:

–æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∏—Å–µ–º –∏ –≤–ª–æ–∂–µ–Ω–∏–π,

–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é (–¥–æ–≥–æ–≤–æ—Ä, –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞, –∏–∑–≤–µ—â–µ–Ω–∏–µ),

–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞,

–±–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –∞–Ω–∞–ª–∏–∑–∞,

—ç–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ JSON.

üîú –ì–æ—Ç–æ–≤ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ—á—Ç–µ (IMAP), –¥–æ–±–∞–≤–∏—Ç—å GPT-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∏–ª–∏ Streamlit-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Äî —Å–æ–æ–±—â–∏—Ç–µ, –∫—É–¥–∞ –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ. 






–í—ã —Å–∫–∞–∑–∞–ª–∏:
–ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ—á—Ç–µ (IMAP), –¥–æ–±–∞–≤–∏—Ç—å GPT-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é


ChatGPT —Å–∫–∞–∑–∞–ª:
–û—Ç–ª–∏—á–Ω–æ, –¥–∞–≤–∞–π—Ç–µ —Ä–∞—Å—à–∏—Ä–∏–º –≤–∞—à –ø—Ä–æ–µ–∫—Ç –¥–≤—É–º—è –≤–∞–∂–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏:

‚úÖ 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ—á—Ç–µ —á–µ—Ä–µ–∑ IMAP
–°–æ–∑–¥–∞–¥–∏–º –º–æ–¥—É–ª—å email_reader.py, –∫–æ—Ç–æ—Ä—ã–π:

–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ø–æ—á—Ç–æ–≤–æ–º—É —è—â–∏–∫—É (Gmail, Yandex, Outlook –∏ –¥—Ä.),

–∏—â–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞ —Å –≤–ª–æ–∂–µ–Ω–∏—è–º–∏,

—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–ª–æ–∂–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É,

–ø–µ—Ä–µ–¥–∞—ë—Ç –∏—Ö –≤ handle_email_request().

üîê –£—Å—Ç–∞–Ω–æ–≤–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–∏–ª–∏ .env)
env
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
EMAIL_HOST=imap.yourmail.com
EMAIL_PORT=993
EMAIL_LOGIN=your@email.com
EMAIL_PASSWORD=your_password_or_app_password
üì© –ú–æ–¥—É–ª—å —á—Ç–µ–Ω–∏—è –ø–∏—Å–µ–º
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
# email_reader.py
import os
import imaplib
import email
from email.header import decode_header

def fetch_attachments(imap_host, login, password, save_dir="temp_files"):
    os.makedirs(save_dir, exist_ok=True)
    with imaplib.IMAP4_SSL(imap_host) as imap:
        imap.login(login, password)
        imap.select("inbox")

        status, messages = imap.search(None, '(UNSEEN)')
        attachments = []

        for num in messages[0].split():
            _, msg_data = imap.fetch(num, '(RFC822)')
            msg = email.message_from_bytes(msg_data[0][1])
            for part in msg.walk():
                if part.get_content_maintype() == 'multipart':
                    continue
                if part.get("Content-Disposition") is None:
                    continue

                filename = part.get_filename()
                if filename:
                    filepath = os.path.join(save_dir, filename)
                    with open(filepath, "wb") as f:
                        f.write(part.get_payload(decode=True))
                    attachments.append(filepath)

        return attachments
ü§ñ 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è GPT –≤ –∞–Ω–∞–ª–∏–∑
–ü–æ–¥–∫–ª—é—á–∏–º OpenAI –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

—É—Å–ª–æ–≤–∏–π –¥–æ–≥–æ–≤–æ—Ä–∞ (extract_key_clauses),

—Ç–∞–±–ª–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤ (extract_goods_table).

üîê –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
env
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
OPENAI_API_KEY=your_openai_key
üß† –ü—Ä–∏–º–µ—Ä GPT-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
# llm/gpt_analyzer.py
import openai
import os
openai.api_key = os.getenv("OPENAI_API_KEY")

def extract_key_clauses(text: str) -> dict:
    prompt = f"–í—ã–¥–µ–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —É—Å–ª–æ–≤–∏—è –∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞:\n{text[:3000]}"
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[{"role": "user", "content": prompt}]
    )
    return response['choices'][0]['message']['content']

def extract_goods_table(text: str) -> list:
    prompt = f"–ò–∑–≤–ª–µ–∫–∏ —Ç–∞–±–ª–∏—Ü—É –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã (–ø–æ–∑–∏—Ü–∏—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω–∞, –µ–¥. –∏–∑–º) –∏–∑:\n{text[:3000]}"
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[{"role": "user", "content": prompt}]
    )
    return response['choices'][0]['message']['content']
üîÅ –û–±–Ω–æ–≤–∏–º handle_email_request.py –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è GPT
–í—Å—Ç–∞–≤–∏–º –≤—ã–∑–æ–≤—ã –∏–∑ llm/gpt_analyzer.py –≤–º–µ—Å—Ç–æ –∑–∞–≥–ª—É—à–µ–∫.

‚è≠Ô∏è –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥
–•–æ—á–µ—à—å:

üîΩ –ü–æ–ª—É—á–∏—Ç—å ZIP —Å —ç—Ç–∏–º–∏ –º–æ–¥—É–ª—è–º–∏,

üåê –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (cron/Task Scheduler),

üì§ –ü–æ–¥–∫–ª—é—á–∏—Ç—å Bitrix24 –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏,

üß™ –ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä —Å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π.

–ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å?






–í—ã —Å–∫–∞–∑–∞–ª–∏:
üîΩ –ü–æ–ª—É—á–∏—Ç—å ZIP —Å —ç—Ç–∏–º–∏ –º–æ–¥—É–ª—è–º–∏,

üåê –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (cron/Task Scheduler),

üì§ –ü–æ–¥–∫–ª—é—á–∏—Ç—å Bitrix24 –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏,


ChatGPT —Å–∫–∞–∑–∞–ª:

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
python
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
import zipfile
from pathlib import Path

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
extended_modules = {
    "email_reader.py": """# email_reader.py
import os
import imaplib
import email
from email.header import decode_header

def fetch_attachments(imap_host, login, password, save_dir="temp_files"):
    os.makedirs(save_dir, exist_ok=True)
    with imaplib.IMAP4_SSL(imap_host) as imap:
        imap.login(login, password)
        imap.select("inbox")
        status, messages = imap.search(None, '(UNSEEN)')
        attachments = []
        for num in messages[0].split():
            _, msg_data = imap.fetch(num, '(RFC822)')
            msg = email.message_from_bytes(msg_data[0][1])
            for part in msg.walk():
                if part.get_content_maintype() == 'multipart':
                    continue
                if part.get("Content-Disposition") is None:
                    continue
                filename = part.get_filename()
                if filename:
                    filepath = os.path.join(save_dir, filename)
                    with open(filepath, "wb") as f:
                        f.write(part.get_payload(decode=True))
                    attachments.append(filepath)
        return attachments
""",
    "llm/gpt_analyzer.py": """# llm/gpt_analyzer.py
import openai
import os

openai.api_key = os.getenv("OPENAI_API_KEY")

def extract_key_clauses(text: str) -> dict:
    prompt = f"–í—ã–¥–µ–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —É—Å–ª–æ–≤–∏—è –∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞:\\n{text[:3000]}"
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[{"role": "user", "content": prompt}]
    )
    return response['choices'][0]['message']['content']

def extract_goods_table(text: str) -> list:
    prompt = f"–ò–∑–≤–ª–µ–∫–∏ —Ç–∞–±–ª–∏—Ü—É –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã (–ø–æ–∑–∏—Ü–∏—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω–∞, –µ–¥. –∏–∑–º) –∏–∑:\\n{text[:3000]}"
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[{"role": "user", "content": prompt}]
    )
    return response['choices'][0]['message']['content']
""",
    "bitrix24/bitrix_sender.py": """# bitrix24/bitrix_sender.py
import requests
import os

BITRIX_WEBHOOK = os.getenv("BITRIX_WEBHOOK")

def send_to_bitrix24(title, description):
    url = f"{BITRIX_WEBHOOK}/crm.lead.add.json"
    data = {
        "fields": {
            "TITLE": title,
            "COMMENTS": description
        }
    }
    r = requests.post(url, json=data)
    return r.json()
""",
    "run_scheduled.py": """# run_scheduled.py
import os
from email_reader import fetch_attachments
from main.handle_email_request import handle_email_request
from dotenv import load_dotenv

load_dotenv()

files = fetch_attachments(
    imap_host=os.getenv("EMAIL_HOST"),
    login=os.getenv("EMAIL_LOGIN"),
    password=os.getenv("EMAIL_PASSWORD")
)
if files:
    handle_email_request(files)
"""
}

# –ü—É—Ç—å –∫ –Ω–æ–≤–æ–º—É –∞—Ä—Ö–∏–≤—É
zip_path_extended = "/mnt/data/contract_parser_extended.zip"

# –°–æ–∑–¥–∞–Ω–∏–µ ZIP —Å –Ω–æ–≤—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
with zipfile.ZipFile(zip_path_extended, "w") as zipf:
    for path, code in extended_modules.items():
        zipf.writestr(path, code)

zip_path_extended
–†–µ–∑—É–ª—å—Ç–∞—Ç
'/mnt/data/contract_parser_extended.zip'
üì¶ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞—Ä—Ö–∏–≤ –≥–æ—Ç–æ–≤:
üëâ –°–∫–∞—á–∞—Ç—å contract_parser_extended.zip

‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç:
email_reader.py ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–æ—á—Ç–æ–≤–æ–º—É —è—â–∏–∫—É —á–µ—Ä–µ–∑ IMAP.

llm/gpt_analyzer.py ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –∏ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã —Å –ø–æ–º–æ—â—å—é GPT.

bitrix24/bitrix_sender.py ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bitrix24 (—Å–æ–∑–¥–∞–Ω–∏–µ –ª–∏–¥–∞).

run_scheduled.py ‚Äî –∑–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ cron –∏–ª–∏ Task Scheduler).

üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ (email + GPT + Bitrix).

–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –≤ cron:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
0 * * * * /usr/bin/python3 /path/to/run_scheduled.py
–ò–ª–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å run_scheduled.py –≤ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –∑–∞–¥–∞–Ω–∏–π Windows.

üîú –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å–æ–±—Ä–∞—Ç—å .env, Dockerfile –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å Streamlit-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ß—Ç–æ –¥–∞–ª—å—à–µ? 






–í—ã —Å–∫–∞–∑–∞–ª–∏:
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ (email + GPT + Bitrix).


ChatGPT —Å–∫–∞–∑–∞–ª:
–í–æ—Ç –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω .env —Ñ–∞–π–ª–∞ –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:

üìÑ .env ‚Äî –ø—Ä–∏–º–µ—Ä
dotenv
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
# üì¨ IMAP –¥–æ—Å—Ç—É–ø –∫ –ø–æ—á—Ç–µ (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∏—Å–µ–º —Å –≤–ª–æ–∂–µ–Ω–∏—è–º–∏)
EMAIL_HOST=imap.yourmailserver.com        # –ü—Ä–∏–º–µ—Ä: imap.gmail.com –∏–ª–∏ imap.yandex.ru
EMAIL_PORT=993
EMAIL_LOGIN=your@email.com
EMAIL_PASSWORD=your_email_password        # –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å app password

# ü§ñ GPT-–∫–ª—é—á OpenAI (–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∏ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã)
OPENAI_API_KEY=sk-...

# üßæ Bitrix24 Webhook (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏–¥–∞/—Å–¥–µ–ª–∫–∏)
BITRIX_WEBHOOK=https://yourdomain.bitrix24.ru/rest/XX/XXXXXXXXXXXXXX
üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ .env –≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö Git.

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .gitignore:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
.env
üîë –ì–¥–µ –≤–∑—è—Ç—å BITRIX_WEBHOOK:
–í Bitrix24 –æ—Ç–∫—Ä–æ–π—Ç–µ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí –í–µ–±—Ö—É–∫–∏.

–°–æ–∑–¥–∞–π—Ç–µ –≤—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ crm.lead.

–ü–æ–ª—É—á–∏—Ç–µ URL, –Ω–∞–ø—Ä–∏–º–µ—Ä:
https://yourcompany.bitrix24.ru/rest/1/a1b2c3d4e5f6g7h8i9/crm.lead.add.json

‚úÖ –ß—Ç–æ –¥–∞–ª—å—à–µ?
–°–æ–∑–¥–∞–π—Ç–µ .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ .env:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
pip install python-dotenv
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ run_scheduled.py –∑–∞–≥—Ä—É–∂–∞–µ—Ç dotenv:

python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
from dotenv import load_dotenv
load_dotenv()
üîú –•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è –¥–æ–±–∞–≤–∏–ª .env.example –ø—Ä—è–º–æ –≤ ZIP?






–í—ã —Å–∫–∞–∑–∞–ª–∏:
–¥–∞


ChatGPT —Å–∫–∞–∑–∞–ª:

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
python
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
# –î–æ–±–∞–≤–∏–º .env.example —Ñ–∞–π–ª –≤ –∞—Ä—Ö–∏–≤
env_example_content = """# üì¨ IMAP –¥–æ—Å—Ç—É–ø –∫ –ø–æ—á—Ç–µ
EMAIL_HOST=imap.yourmailserver.com
EMAIL_PORT=993
EMAIL_LOGIN=your@email.com
EMAIL_PASSWORD=your_password_or_app_password

# ü§ñ GPT OpenAI –∫–ª—é—á
OPENAI_API_KEY=sk-...

# üßæ Bitrix24 Webhook
BITRIX_WEBHOOK=https://yourcompany.bitrix24.ru/rest/1/a1b2c3d4e5f6g7h8i9
"""

# –î–æ–±–∞–≤–∏–º –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞—Ä—Ö–∏–≤
zip_path_extended = "/mnt/data/contract_parser_extended.zip"

with zipfile.ZipFile(zip_path_extended, "a") as zipf:
    zipf.writestr(".env.example", env_example_content)

zip_path_extended
–†–µ–∑—É–ª—å—Ç–∞—Ç
'/mnt/data/contract_parser_extended.zip'
üì¶ –§–∞–π–ª .env.example –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∞—Ä—Ö–∏–≤:
üëâ –°–∫–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π contract_parser_extended.zip

–¢–µ–ø–µ—Ä—å –≤ –∞—Ä—Ö–∏–≤–µ –µ—Å—Ç—å –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ:

–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è .env,

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø–æ—á—Ç–æ–π, GPT –∏ Bitrix24,

–°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.